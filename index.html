<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>XenMessenger</title>
  <script src="https://unpkg.com/react@17/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  
  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
  
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      background-color: #000;
      color: #fff;
      overflow-x: hidden;
    }
    .app-container {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }
    /* Login Screen */
    .login-container {
      min-height: 100vh;
      background-color: #000;
      color: #fff;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 1rem;
    }
    .login-box {
      width: 100%;
      max-width: 28rem;
      transition: all 0.3s;
    }
    .login-header {
      text-align: center;
      margin-bottom: 3rem;
      transition: all 0.5s;
    }
    .logo-circle {
      width: 5rem;
      height: 5rem;
      background-color: #fff;
      border-radius: 50%;
      margin: 0 auto 1rem;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.5s;
    }
    .logo-circle:hover {
      transform: scale(1.1) rotate(12deg);
    }
    .logo-icon {
      width: 2.5rem;
      height: 2.5rem;
      color: #000;
    }
    .login-title {
      font-size: 2.25rem;
      font-weight: bold;
      margin-bottom: 0.5rem;
    }
    .login-subtitle {
      color: #9ca3af;
    }
    .error-box {
      margin-bottom: 1rem;
      padding: 1rem;
      background-color: rgba(239, 68, 68, 0.2);
      border: 1px solid #ef4444;
      border-radius: 1.5rem;
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }
    .error-icon {
      width: 1.25rem;
      height: 1.25rem;
      color: #ef4444;
      flex-shrink: 0;
    }
    .error-text {
      font-size: 0.875rem;
      color: #fca5a5;
    }
    .input-field {
      width: 100%;
      padding: 1rem 1.5rem;
      background-color: rgba(255, 255, 255, 0.1);
      border-radius: 9999px;
      color: #fff;
      outline: none;
      transition: all 0.3s;
      margin-bottom: 1rem;
      border: none;
    }
    .input-field:focus {
      background-color: rgba(255, 255, 255, 0.2);
      transform: scale(1.02);
    }
    .input-field:hover {
      transform: scale(1.02);
    }
    .input-field::placeholder {
      color: #9ca3af;
    }
    .btn-primary {
      width: 100%;
      padding: 1rem;
      background-color: #fff;
      color: #000;
      font-weight: 600;
      border-radius: 9999px;
      border: none;
      cursor: pointer;
      transition: all 0.3s;
      margin-bottom: 1rem;
    }
    .btn-primary:hover {
      background-color: rgba(255, 255, 255, 0.9);
      transform: scale(1.05);
    }
    .btn-primary:active {
      transform: scale(0.95);
    }
    .btn-primary:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    .auth-switch {
      text-align: center;
      padding-top: 1rem;
    }
    .auth-switch-text {
      color: #9ca3af;
    }
    .auth-switch-btn {
      color: #fff;
      font-weight: 600;
      background: none;
      border: none;
      cursor: pointer;
      transition: all 0.2s;
    }
    .auth-switch-btn:hover {
      text-decoration: underline;
    }
    /* Demo Mode Notice */
    .demo-notice {
      margin: 1rem 0;
      padding: 1rem;
      background-color: rgba(59, 130, 246, 0.2);
      border: 1px solid #3b82f6;
      border-radius: 1.5rem;
      text-align: center;
    }
    .demo-notice-text {
      font-size: 0.875rem;
      color: #93c5fd;
    }
    /* Main App */
    .main-container {
      min-height: 100vh;
      background-color: #000;
      color: #fff;
      display: flex;
      flex-direction: column;
    }
    .header {
      padding: 1rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
    }
    .header-title {
      font-size: 1.5rem;
      font-weight: bold;
    }
    .icon-btn {
      padding: 0.5rem;
      border-radius: 50%;
      border: none;
      background: none;
      cursor: pointer;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #fff;
    }
    .icon-btn:hover {
      background-color: rgba(255, 255, 255, 0.1);
      transform: rotate(90deg);
    }
    .icon-btn:active {
      transform: scale(0.95);
    }
    .search-bar {
      padding: 1rem;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }
    .search-input {
      width: 100%;
      padding: 0.75rem 1rem;
      background-color: rgba(255, 255, 255, 0.1);
      border-radius: 9999px;
      color: #fff;
      outline: none;
      border: none;
      transition: all 0.3s;
    }
    .search-input:focus {
      background-color: rgba(255, 255, 255, 0.2);
    }
    .chats-list {
      flex: 1;
      overflow-y: auto;
      padding-bottom: 5rem;
    }
    .chat-item {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding: 1rem;
      cursor: pointer;
      transition: all 0.3s;
    }
    .chat-item:hover {
      background-color: rgba(255, 255, 255, 0.05);
      transform: translateX(0.25rem);
    }
    .chat-item:active {
      background-color: rgba(255, 255, 255, 0.1);
    }
    .chat-avatar {
      width: 3.5rem;
      height: 3.5rem;
      border-radius: 50%;
      background-color: rgba(255, 255, 255, 0.1);
      transition: all 0.3s;
    }
    .chat-avatar:hover {
      transform: scale(1.1);
    }
    .chat-info {
      flex: 1;
      min-width: 0;
    }
    .chat-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 0.25rem;
    }
    .chat-username {
      font-weight: 600;
    }
    .chat-time {
      font-size: 0.75rem;
      color: #9ca3af;
    }
    .chat-last-message {
      font-size: 0.875rem;
      color: #9ca3af;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .unread-badge {
      width: 1.5rem;
      height: 1.5rem;
      background-color: #fff;
      color: #000;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.75rem;
      font-weight: bold;
    }
    /* Settings */
    .settings-container {
      flex: 1;
      overflow-y: auto;
      padding-bottom: 5rem;
    }
    .profile-section {
      padding: 1.5rem;
      text-align: center;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }
    .profile-avatar {
      width: 6rem;
      height: 6rem;
      border-radius: 50%;
      margin: 0 auto 1rem;
      background-color: rgba(255, 255, 255, 0.1);
      transition: all 0.5s;
    }
    .profile-avatar:hover {
      transform: scale(1.1) rotate(6deg);
    }
    .profile-name {
      font-size: 1.25rem;
      font-weight: bold;
    }
    .settings-section {
      padding: 1rem;
    }
    .section-title {
      font-size: 0.875rem;
      font-weight: bold;
      color: #9ca3af;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      margin-bottom: 0.75rem;
      padding-left: 0.5rem;
    }
    .settings-item {
      padding: 1rem;
      background-color: rgba(255, 255, 255, 0.05);
      border-radius: 1.5rem;
      margin-bottom: 0.25rem;
      cursor: pointer;
      transition: all 0.3s;
    }
    .settings-item:hover {
      background-color: rgba(255, 255, 255, 0.1);
      transform: translateX(0.25rem);
    }
    .settings-item:active {
      transform: scale(0.98);
    }
    .settings-label {
      font-size: 0.875rem;
      color: #9ca3af;
    }
    .settings-value {
      font-weight: 500;
    }
    /* Bottom Navigation */
    .bottom-nav {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background-color: #000;
      border-top: 1px solid rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
    }
    .nav-container {
      display: flex;
      align-items: center;
      justify-content: space-around;
      padding: 0.75rem 1rem;
      max-width: 28rem;
      margin: 0 auto;
    }
    .nav-btn {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0.25rem;
      padding: 0.5rem 1.5rem;
      border-radius: 9999px;
      border: none;
      background: none;
      cursor: pointer;
      transition: all 0.3s;
    }
    .nav-btn:active {
      transform: scale(0.95);
    }
    .nav-btn.active {
      background-color: rgba(255, 255, 255, 0.1);
      transform: scale(1.05);
    }
    .nav-btn:hover:not(.active) {
      transform: scale(1.05);
    }
    .nav-icon {
      width: 1.5rem;
      height: 1.5rem;
      transition: all 0.3s;
    }
    .nav-icon.active {
      color: #fff;
    }
    .nav-icon.inactive {
      color: #9ca3af;
    }
    .nav-label {
      font-size: 0.75rem;
      font-weight: 500;
      transition: all 0.3s;
    }
    .nav-label.active {
      color: #fff;
    }
    .nav-label.inactive {
      color: #9ca3af;
    }
    .loading {
      text-align: center;
      padding: 2rem;
      color: #9ca3af;
    }
    /* Chat Screen */
    .chat-container {
      flex: 1;
      display: flex;
      flex-direction: column;
      position: relative;
    }
    .chat-header {
      padding: 1rem;
      display: flex;
      align-items: center;
      gap: 0.75rem;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
    }
    .chat-header-avatar {
      width: 2.5rem;
      height: 2.5rem;
      border-radius: 50%;
      background-color: rgba(255, 255, 255, 0.1);
    }
    .chat-header-info {
      flex: 1;
    }
    .chat-header-username {
      font-weight: 600;
    }
    .chat-header-status {
      font-size: 0.75rem;
      color: #9ca3af;
    }
    .messages-container {
      flex: 1;
      overflow-y: auto;
      padding: 1rem;
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
    }
    .message {
      max-width: 70%;
      padding: 0.75rem 1rem;
      border-radius: 1.5rem;
      position: relative;
      animation: fade-in 0.3s ease-out;
    }
    .message.sent {
      align-self: flex-end;
      background-color: #fff;
      color: #000;
      border-bottom-right-radius: 0.5rem;
    }
    .message.received {
      align-self: flex-start;
      background-color: rgba(255, 255, 255, 0.1);
      border-bottom-left-radius: 0.5rem;
    }
    .message-time {
      font-size: 0.625rem;
      color: #9ca3af;
      margin-top: 0.25rem;
      text-align: right;
    }
    .message-input-container {
      padding: 1rem;
      border-top: 1px solid rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
    }
    .message-input-wrapper {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    .message-input {
      flex: 1;
      padding: 0.75rem 1rem;
      background-color: rgba(255, 255, 255, 0.1);
      border-radius: 9999px;
      color: #fff;
      outline: none;
      border: none;
      transition: all 0.3s;
    }
    .message-input:focus {
      background-color: rgba(255, 255, 255, 0.2);
    }
    .send-button {
      padding: 0.75rem;
      background-color: #fff;
      color: #000;
      border-radius: 50%;
      border: none;
      cursor: pointer;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .send-button:hover {
      background-color: rgba(255, 255, 255, 0.9);
      transform: scale(1.05);
    }
    .send-button:active {
      transform: scale(0.95);
    }
    .send-button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    /* New Chat Modal */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: rgba(0, 0, 0, 0.8);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      padding: 1rem;
      animation: fade-in 0.3s ease-out;
    }
    .modal-content {
      width: 100%;
      max-width: 28rem;
      background-color: #000;
      border-radius: 1.5rem;
      border: 1px solid rgba(255, 255, 255, 0.1);
      overflow: hidden;
      animation: slide-down 0.3s ease-out;
    }
    .modal-header {
      padding: 1.5rem;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .modal-title {
      font-size: 1.25rem;
      font-weight: bold;
    }
    .modal-close {
      padding: 0.5rem;
      border-radius: 50%;
      border: none;
      background: none;
      cursor: pointer;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #fff;
    }
    .modal-close:hover {
      background-color: rgba(255, 255, 255, 0.1);
    }
    .modal-body {
      padding: 1rem;
      max-height: 20rem;
      overflow-y: auto;
    }
    .user-item {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding: 1rem;
      cursor: pointer;
      transition: all 0.3s;
      border-radius: 1rem;
    }
    .user-item:hover {
      background-color: rgba(255, 255, 255, 0.05);
    }
    .user-avatar {
      width: 3rem;
      height: 3rem;
      border-radius: 50%;
      background-color: rgba(255, 255, 255, 0.1);
    }
    .user-info {
      flex: 1;
    }
    .user-username {
      font-weight: 600;
    }
    .user-email {
      font-size: 0.875rem;
      color: #9ca3af;
    }
    /* Animations */
    @keyframes fade-in {
      from { opacity: 0; transform: translateY(-20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-10px); }
      75% { transform: translateX(10px); }
    }
    @keyframes slide-down {
      from { opacity: 0; transform: translateY(-20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    @keyframes slide-in-left {
      from { opacity: 0; transform: translateX(-30px); }
      to { opacity: 1; transform: translateX(0); }
    }
    @keyframes bounce-subtle {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.1); }
    }
    .animate-fade-in {
      animation: fade-in 0.6s ease-out;
    }
    .animate-shake {
      animation: shake 0.4s ease-in-out;
    }
    .animate-slide-down {
      animation: slide-down 0.3s ease-out;
    }
    .animate-bounce-subtle {
      animation: bounce-subtle 2s infinite;
    }
    .opacity-0 {
      opacity: 0;
    }
    .opacity-100 {
      opacity: 1;
    }
    .scale-95 {
      transform: scale(0.95);
    }
    .scale-100 {
      transform: scale(1);
    }
  </style>
</head>
<body>
  <div id="root">
    <div style="display: flex; justify-content: center; align-items: center; height: 100vh; background: #000; color: #fff;">
      <div style="text-align: center;">
        <div style="width: 80px; height: 80px; background: #fff; border-radius: 50%; margin: 0 auto 20px; display: flex; align-items: center; justify-content: center;">
          <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M7.9 20A9 9 0 1 0 4 16.1L2 22Z"></path>
          </svg>
        </div>
        <h1 style="font-size: 2rem; margin-bottom: 10px;">XenMessenger</h1>
        <p style="color: #9ca3af; margin-bottom: 20px;">Loading...</p>
      </div>
    </div>
  </div>
  
  <script type="text/babel">
    // Проверка доступности React
    if (typeof React === 'undefined') {
      document.getElementById('root').innerHTML = `
        <div style="display: flex; justify-content: center; align-items: center; height: 100vh; background: #000; color: #fff;">
          <div style="text-align: center;">
            <h1 style="color: #ef4444; margin-bottom: 20px;">Error Loading React</h1>
            <p>Please check your internet connection and refresh the page.</p>
          </div>
        </div>
      `;
      throw new Error('React is not loaded');
    }

    const { useState, useEffect } = React;
  
    // Конфигурация Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyC8zwOfm5qyF_r2A1TTGCNb7pQyoaEe56w",
      authDomain: "xenmessenger.firebaseapp.com",
      projectId: "xenmessenger",
      storageBucket: "xenmessenger.firebasestorage.app",
      messagingSenderId: "912355915340",
      appId: "1:912355915340:web:bd0d783cba08883c2d66e9",
      measurementId: "G-2BXDQJJWVW",
      databaseURL: "https://xenmessenger-default-rtdb.firebaseio.com"
    };

    // Переменные для Firebase
    let auth = null;
    let db = null;
    let realtimeDb = null;
    let firebaseInitialized = false;

    // Безопасная инициализация Firebase
    try {
      if (typeof firebase !== 'undefined' && !firebase.apps.length) {
        firebase.initializeApp(firebaseConfig);
        firebaseInitialized = true;
        auth = firebase.auth();
        db = firebase.firestore();
        realtimeDb = firebase.database();
      }
    } catch (error) {
      console.log('Firebase running in demo mode');
    }
  
    // Иконки как компоненты React
    const SearchIcon = ({ className = '' }) => (
      React.createElement('svg', {
        xmlns: 'http://www.w3.org/2000/svg',
        width: 24,
        height: 24,
        viewBox: '0 0 24 24',
        fill: 'none',
        stroke: 'currentColor',
        strokeWidth: 2,
        strokeLinecap: 'round',
        strokeLinejoin: 'round',
        className
      },
        React.createElement('circle', { cx: 11, cy: 11, r: 8 }),
        React.createElement('path', { d: 'm21 21-4.3-4.3' })
      )
    );
  
    const MessageCircleIcon = ({ className = '' }) => (
      React.createElement('svg', {
        xmlns: 'http://www.w3.org/2000/svg',
        width: 24,
        height: 24,
        viewBox: '0 0 24 24',
        fill: 'none',
        stroke: 'currentColor',
        strokeWidth: 2,
        strokeLinecap: 'round',
        strokeLinejoin: 'round',
        className
      },
        React.createElement('path', { d: 'M7.9 20A9 9 0 1 0 4 16.1L2 22Z' })
      )
    );
  
    const SettingsIcon = ({ className = '' }) => (
      React.createElement('svg', {
        xmlns: 'http://www.w3.org/2000/svg',
        width: 24,
        height: 24,
        viewBox: '0 0 24 24',
        fill: 'none',
        stroke: 'currentColor',
        strokeWidth: 2,
        strokeLinecap: 'round',
        strokeLinejoin: 'round',
        className
      },
        React.createElement('path', { d: 'M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z' }),
        React.createElement('circle', { cx: 12, cy: 12, r: 3 })
      )
    );
  
    const AlertCircleIcon = ({ className = '' }) => (
      React.createElement('svg', {
        xmlns: 'http://www.w3.org/2000/svg',
        width: 24,
        height: 24,
        viewBox: '0 0 24 24',
        fill: 'none',
        stroke: 'currentColor',
        strokeWidth: 2,
        strokeLinecap: 'round',
        strokeLinejoin: 'round',
        className
      },
        React.createElement('circle', { cx: 12, cy: 12, r: 10 }),
        React.createElement('line', { x1: 12, y1: 8, x2: 12, y2: 12 }),
        React.createElement('line', { x1: 12, y1: 16, x2: 12.01, y2: 16 })
      )
    );
  
    const PlusIcon = ({ className = '' }) => (
      React.createElement('svg', {
        xmlns: 'http://www.w3.org/2000/svg',
        width: 24,
        height: 24,
        viewBox: '0 0 24 24',
        fill: 'none',
        stroke: 'currentColor',
        strokeWidth: 2,
        strokeLinecap: 'round',
        strokeLinejoin: 'round',
        className
      },
        React.createElement('line', { x1: 12, y1: 5, x2: 12, y2: 19 }),
        React.createElement('line', { x1: 5, y1: 12, x2: 19, y2: 12 })
      )
    );
  
    const SendIcon = ({ className = '' }) => (
      React.createElement('svg', {
        xmlns: 'http://www.w3.org/2000/svg',
        width: 24,
        height: 24,
        viewBox: '0 0 24 24',
        fill: 'none',
        stroke: 'currentColor',
        strokeWidth: 2,
        strokeLinecap: 'round',
        strokeLinejoin: 'round',
        className
      },
        React.createElement('line', { x1: 22, y1: 2, x2: 11, y2: 13 }),
        React.createElement('polygon', { points: '22 2 15 22 11 13 2 9 22 2' })
      )
    );
  
    const XIcon = ({ className = '' }) => (
      React.createElement('svg', {
        xmlns: 'http://www.w3.org/2000/svg',
        width: 24,
        height: 24,
        viewBox: '0 0 24 24',
        fill: 'none',
        stroke: 'currentColor',
        strokeWidth: 2,
        strokeLinecap: 'round',
        strokeLinejoin: 'round',
        className
      },
        React.createElement('line', { x1: 18, y1: 6, x2: 6, y2: 18 }),
        React.createElement('line', { x1: 6, y1: 6, x2: 18, y2: 18 })
      )
    );
  
    // Основной компонент приложения
    function ModernMessenger() {
      const [currentScreen, setCurrentScreen] = useState('login');
      const [activeTab, setActiveTab] = useState('chats');
      const [isRegistering, setIsRegistering] = useState(false);
      const [loginData, setLoginData] = useState({ email: '', password: '' });
      const [registerData, setRegisterData] = useState({ email: '', username: '', password: '' });
      const [error, setError] = useState('');
      const [user, setUser] = useState(null);
      const [searchActive, setSearchActive] = useState(false);
      const [chats, setChats] = useState([]);
      const [loading, setLoading] = useState(false);
      const [users, setUsers] = useState([]);
      const [showNewChatModal, setShowNewChatModal] = useState(false);
      const [activeChat, setActiveChat] = useState(null);
      const [messages, setMessages] = useState([]);
      const [newMessage, setNewMessage] = useState('');
      const [searchQuery, setSearchQuery] = useState('');
      const [demoMode, setDemoMode] = useState(!firebaseInitialized);
      
      // Демо-данные
      const demoUsers = [
        { id: 'demo1', username: 'alice', email: 'alice@example.com' },
        { id: 'demo2', username: 'bob', email: 'bob@example.com' },
        { id: 'demo3', username: 'charlie', email: 'charlie@example.com' }
      ];

      const demoChats = [
        {
          id: 'chat1',
          participants: ['current', 'demo1'],
          participantNames: { 'current': 'user', 'demo1': 'alice' },
          lastMessage: 'Hello! How are you?',
          lastMessageTime: Date.now() - 3600000
        },
        {
          id: 'chat2', 
          participants: ['current', 'demo2'],
          participantNames: { 'current': 'user', 'demo2': 'bob' },
          lastMessage: 'See you tomorrow!',
          lastMessageTime: Date.now() - 7200000
        }
      ];

      // Инициализация приложения
      useEffect(() => {
        if (demoMode) {
          // Демо-режим: автоматический вход
          const demoUser = {
            id: 'demo-user',
            email: 'demo@xenmessenger.com',
            username: 'user',
            avatar: 'https://api.dicebear.com/7.x/avataaars/svg?seed=user'
          };
          setUser(demoUser);
          setChats(demoChats);
          setUsers(demoUsers);
          setCurrentScreen('main');
        } else if (firebaseInitialized) {
          // Режим Firebase: отслеживание аутентификации
          const unsubscribe = auth.onAuthStateChanged((firebaseUser) => {
            if (firebaseUser) {
              setUser({
                id: firebaseUser.uid,
                email: firebaseUser.email,
                username: firebaseUser.email.split('@')[0],
                avatar: `https://api.dicebear.com/7.x/avataaars/svg?seed=${firebaseUser.email.split('@')[0]}`
              });
              setCurrentScreen('main');
            }
            setLoading(false);
          });
          return () => unsubscribe();
        }
      }, [demoMode]);

      // Загрузка чатов
      useEffect(() => {
        if (user && !demoMode && realtimeDb) {
          const chatsRef = realtimeDb.ref('chats');
          const unsubscribe = chatsRef.on('value', (snapshot) => {
            const data = snapshot.val();
            if (data) {
              const chatsArray = Object.keys(data).map(key => ({
                id: key,
                ...data[key]
              })).filter(chat => chat.participants?.includes(user.id));
              setChats(chatsArray);
            }
          });
          return () => chatsRef.off('value', unsubscribe);
        } else if (demoMode) {
          setChats(demoChats);
        }
      }, [user, demoMode]);

      // Простые функции аутентификации
      const handleLogin = async () => {
        setError('');
        setLoading(true);
        
        if (!loginData.email || !loginData.password) {
          setError('Please fill in all fields');
          setLoading(false);
          return;
        }

        if (demoMode || !firebaseInitialized) {
          // Демо-вход
          setTimeout(() => {
            setUser({
              id: 'demo-user',
              email: loginData.email,
              username: loginData.email.split('@')[0],
              avatar: `https://api.dicebear.com/7.x/avataaars/svg?seed=${loginData.email.split('@')[0]}`
            });
            setChats(demoChats);
            setUsers(demoUsers);
            setCurrentScreen('main');
            setLoading(false);
          }, 1000);
        } else {
          // Firebase вход
          try {
            await auth.signInWithEmailAndPassword(loginData.email, loginData.password);
          } catch (err) {
            setError('Login failed: ' + err.message);
            setLoading(false);
          }
        }
      };

      const handleRegister = async () => {
        setError('');
        setLoading(true);
        
        if (!registerData.email || !registerData.username || !registerData.password) {
          setError('Please fill in all fields');
          setLoading(false);
          return;
        }

        if (demoMode || !firebaseInitialized) {
          // Демо-регистрация
          setTimeout(() => {
            setUser({
              id: 'demo-user',
              email: registerData.email,
              username: registerData.username,
              avatar: `https://api.dicebear.com/7.x/avataaars/svg?seed=${registerData.username}`
            });
            setChats(demoChats);
            setUsers(demoUsers);
            setCurrentScreen('main');
            setLoading(false);
          }, 1000);
        } else {
          // Firebase регистрация
          try {
            await auth.createUserWithEmailAndPassword(registerData.email, registerData.password);
          } catch (err) {
            setError('Registration failed: ' + err.message);
            setLoading(false);
          }
        }
      };

      const switchAuthMode = () => {
        setError('');
        setIsRegistering(!isRegistering);
      };

      const startNewChat = (otherUser) => {
        const newChat = {
          id: 'chat-' + Date.now(),
          participants: ['current', otherUser.id],
          participantNames: {
            'current': user.username,
            [otherUser.id]: otherUser.username
          },
          lastMessage: '',
          lastMessageTime: Date.now()
        };
        
        setActiveChat(newChat);
        setChats(prev => [newChat, ...prev]);
        setShowNewChatModal(false);
        setCurrentScreen('chat');
      };

      const sendMessage = () => {
        if (!newMessage.trim() || !activeChat) return;

        const message = {
          id: 'msg-' + Date.now(),
          text: newMessage,
          senderId: 'current',
          senderName: user.username,
          timestamp: Date.now()
        };

        setMessages(prev => [...prev, message]);
        setChats(prev => prev.map(chat => 
          chat.id === activeChat.id 
            ? { ...chat, lastMessage: newMessage, lastMessageTime: Date.now() }
            : chat
        ));
        setNewMessage('');
      };

      const formatTime = (timestamp) => {
        return new Date(timestamp).toLocaleTimeString([], { 
          hour: '2-digit', minute: '2-digit' 
        });
      };

      const logout = () => {
        if (!demoMode && auth) {
          auth.signOut();
        }
        setUser(null);
        setCurrentScreen('login');
        setLoginData({ email: '', password: '' });
      };

      // Фильтрация
      const filteredUsers = users.filter(userItem =>
        userItem.username.toLowerCase().includes(searchQuery.toLowerCase())
      );

      const filteredChats = chats.filter(chat =>
        Object.values(chat.participantNames || {}).some(name =>
          name.toLowerCase().includes(searchQuery.toLowerCase())
        )
      );

      // Рендер экрана логина
      if (currentScreen === 'login') {
        return React.createElement('div', { className: 'login-container' },
          React.createElement('div', { className: 'login-box' },
            React.createElement('div', { className: 'login-header' },
              React.createElement('div', { className: 'logo-circle' },
                React.createElement(MessageCircleIcon, { className: 'logo-icon' })
              ),
              React.createElement('h1', { className: 'login-title' }, 'XenMessenger'),
              React.createElement('p', { className: 'login-subtitle' }, 'Connect with everyone')
            ),

            demoMode && React.createElement('div', { className: 'demo-notice' },
              React.createElement('p', { className: 'demo-notice-text' }, 
                'Demo Mode - Using local storage'
              )
            ),

            error && React.createElement('div', { className: 'error-box' },
              React.createElement(AlertCircleIcon, { className: 'error-icon' }),
              React.createElement('p', { className: 'error-text' }, error)
            ),

            !isRegistering
              ? [
                  React.createElement('input', {
                    key: 'email',
                    type: 'email',
                    placeholder: 'Email',
                    value: loginData.email,
                    onChange: (e) => setLoginData({...loginData, email: e.target.value}),
                    className: 'input-field',
                    disabled: loading
                  }),
                  React.createElement('input', {
                    key: 'password',
                    type: 'password',
                    placeholder: 'Password',
                    value: loginData.password,
                    onChange: (e) => setLoginData({...loginData, password: e.target.value}),
                    className: 'input-field',
                    disabled: loading
                  }),
                  React.createElement('button', {
                    key: 'login-btn',
                    onClick: handleLogin,
                    className: 'btn-primary',
                    disabled: loading
                  }, loading ? 'Loading...' : 'Log In'),
                  React.createElement('div', { key: 'auth-switch', className: 'auth-switch' },
                    React.createElement('span', { className: 'auth-switch-text' }, "Don't have an account? "),
                    React.createElement('button', {
                      onClick: switchAuthMode,
                      className: 'auth-switch-btn',
                      disabled: loading
                    }, 'Register')
                  )
                ]
              : [
                  React.createElement('input', {
                    key: 'reg-email',
                    type: 'email',
                    placeholder: 'Email',
                    value: registerData.email,
                    onChange: (e) => setRegisterData({...registerData, email: e.target.value}),
                    className: 'input-field',
                    disabled: loading
                  }),
                  React.createElement('input', {
                    key: 'username',
                    type: 'text',
                    placeholder: 'Username',
                    value: registerData.username,
                    onChange: (e) => setRegisterData({...registerData, username: e.target.value}),
                    className: 'input-field',
                    disabled: loading
                  }),
                  React.createElement('input', {
                    key: 'reg-password',
                    type: 'password',
                    placeholder: 'Password',
                    value: registerData.password,
                    onChange: (e) => setRegisterData({...registerData, password: e.target.value}),
                    className: 'input-field',
                    disabled: loading
                  }),
                  React.createElement('button', {
                    key: 'register-btn',
                    onClick: handleRegister,
                    className: 'btn-primary',
                    disabled: loading
                  }, loading ? 'Loading...' : 'Register'),
                  React.createElement('div', { key: 'reg-auth-switch', className: 'auth-switch' },
                    React.createElement('span', { className: 'auth-switch-text' }, 'Already have an account? '),
                    React.createElement('button', {
                      onClick: switchAuthMode,
                      className: 'auth-switch-btn',
                      disabled: loading
                    }, 'Log In')
                  )
                ]
          )
        );
      }

      // Рендер экрана чата
      if (currentScreen === 'chat' && activeChat) {
        const otherParticipantId = activeChat.participants.find(id => id !== 'current');
        const otherParticipantName = activeChat.participantNames[otherParticipantId];

        return React.createElement('div', { className: 'chat-container' },
          React.createElement('div', { className: 'chat-header' },
            React.createElement('button', {
              onClick: () => setCurrentScreen('main'),
              className: 'icon-btn'
            }, React.createElement(XIcon, { className: 'nav-icon active' })),
            React.createElement('img', {
              src: `https://api.dicebear.com/7.x/avataaars/svg?seed=${otherParticipantName}`,
              alt: otherParticipantName,
              className: 'chat-header-avatar'
            }),
            React.createElement('div', { className: 'chat-header-info' },
              React.createElement('div', { className: 'chat-header-username' }, `@${otherParticipantName}`),
              React.createElement('div', { className: 'chat-header-status' }, 'Online')
            )
          ),
          
          React.createElement('div', { className: 'messages-container' },
            messages.map(message =>
              React.createElement('div', {
                key: message.id,
                className: `message ${message.senderId === 'current' ? 'sent' : 'received'}`
              },
                React.createElement('div', null, message.text),
                React.createElement('div', { className: 'message-time' }, 
                  formatTime(message.timestamp)
                )
              )
            )
          ),
          
          React.createElement('div', { className: 'message-input-container' },
            React.createElement('div', { className: 'message-input-wrapper' },
              React.createElement('input', {
                type: 'text',
                placeholder: 'Type a message...',
                value: newMessage,
                onChange: (e) => setNewMessage(e.target.value),
                onKeyPress: (e) => e.key === 'Enter' && sendMessage(),
                className: 'message-input'
              }),
              React.createElement('button', {
                onClick: sendMessage,
                className: 'send-button',
                disabled: !newMessage.trim()
              }, React.createElement(SendIcon, { className: 'nav-icon active' }))
            )
          )
        );
      }

      // Рендер главного экрана
      return React.createElement('div', { className: 'main-container' },
        demoMode && React.createElement('div', { className: 'demo-notice' },
          React.createElement('p', { className: 'demo-notice-text' }, 
            'Demo Mode - Data is stored locally'
          )
        ),
        
        activeTab === 'chats' && React.createElement('div', null,
          React.createElement('div', { className: 'header' },
            React.createElement('h1', { className: 'header-title' }, 'Chats'),
            React.createElement('div', { style: { display: 'flex', gap: '0.5rem' } },
              React.createElement('button', {
                onClick: () => setShowNewChatModal(true),
                className: 'icon-btn'
              }, React.createElement(PlusIcon, { className: 'nav-icon active' })),
              React.createElement('button', {
                onClick: () => setSearchActive(!searchActive),
                className: 'icon-btn'
              }, React.createElement(SearchIcon, { className: 'nav-icon active' }))
            )
          ),

          searchActive && React.createElement('div', { className: 'search-bar' },
            React.createElement('input', {
              type: 'text',
              placeholder: 'Search chats...',
              value: searchQuery,
              onChange: (e) => setSearchQuery(e.target.value),
              className: 'search-input'
            })
          ),

          React.createElement('div', { className: 'chats-list' },
            filteredChats.length === 0
              ? React.createElement('div', { className: 'loading' }, 
                  searchQuery ? 'No chats found' : 'No chats yet'
                )
              : filteredChats.map(chat => {
                  const otherParticipantId = chat.participants.find(id => id !== 'current');
                  const otherParticipantName = chat.participantNames[otherParticipantId];
                  
                  return React.createElement('div', {
                    key: chat.id,
                    className: 'chat-item',
                    onClick: () => {
                      setActiveChat(chat);
                      setCurrentScreen('chat');
                    }
                  },
                    React.createElement('img', {
                      src: `https://api.dicebear.com/7.x/avataaars/svg?seed=${otherParticipantName}`,
                      alt: otherParticipantName,
                      className: 'chat-avatar'
                    }),
                    React.createElement('div', { className: 'chat-info' },
                      React.createElement('div', { className: 'chat-header' },
                        React.createElement('span', { className: 'chat-username' }, `@${otherParticipantName}`),
                        React.createElement('span', { className: 'chat-time' }, 
                          formatTime(chat.lastMessageTime)
                        )
                      ),
                      React.createElement('p', { className: 'chat-last-message' }, chat.lastMessage)
                    )
                  );
                })
          )
        ),

        activeTab === 'settings' && user && React.createElement('div', { className: 'settings-container' },
          React.createElement('div', { className: 'profile-section' },
            React.createElement('img', {
              src: user.avatar,
              alt: user.username,
              className: 'profile-avatar'
            }),
            React.createElement('h2', { className: 'profile-name' }, `@${user.username}`)
          ),

          React.createElement('div', { className: 'settings-section' },
            React.createElement('h3', { className: 'section-title' }, 'Account'),
            React.createElement('div', { className: 'settings-item' },
              React.createElement('p', { className: 'settings-label' }, 'Email'),
              React.createElement('p', { className: 'settings-value' }, user.email)
            ),
            React.createElement('div', { className: 'settings-item' },
              React.createElement('p', { className: 'settings-label' }, 'Username'),
              React.createElement('p', { className: 'settings-value' }, `@${user.username}`)
            )
          ),

          React.createElement('div', { className: 'settings-section' },
            React.createElement('h3', { className: 'section-title' }, 'App'),
            React.createElement('div', { className: 'settings-item' },
              React.createElement('p', { className: 'settings-value' }, 'Mode: ' + (demoMode ? 'Demo' : 'Firebase'))
            )
          ),

          React.createElement('div', { className: 'settings-section' },
            React.createElement('div', { 
              className: 'settings-item',
              onClick: logout,
              style: { color: '#ef4444' }
            }, React.createElement('p', { className: 'settings-value' }, 'Logout'))
          )
        ),

        showNewChatModal && React.createElement('div', { className: 'modal-overlay' },
          React.createElement('div', { className: 'modal-content' },
            React.createElement('div', { className: 'modal-header' },
              React.createElement('h2', { className: 'modal-title' }, 'New Chat'),
              React.createElement('button', {
                onClick: () => setShowNewChatModal(false),
                className: 'modal-close'
              }, React.createElement(XIcon, { className: 'nav-icon active' }))
            ),
            React.createElement('div', { className: 'search-bar' },
              React.createElement('input', {
                type: 'text',
                placeholder: 'Search users...',
                value: searchQuery,
                onChange: (e) => setSearchQuery(e.target.value),
                className: 'search-input'
              })
            ),
            React.createElement('div', { className: 'modal-body' },
              filteredUsers.map(userItem =>
                React.createElement('div', {
                  key: userItem.id,
                  className: 'user-item',
                  onClick: () => startNewChat(userItem)
                },
                  React.createElement('img', {
                    src: `https://api.dicebear.com/7.x/avataaars/svg?seed=${userItem.username}`,
                    alt: userItem.username,
                    className: 'user-avatar'
                  }),
                  React.createElement('div', { className: 'user-info' },
                    React.createElement('div', { className: 'user-username' }, `@${userItem.username}`),
                    React.createElement('div', { className: 'user-email' }, userItem.email)
                  )
                )
              )
            )
          )
        ),

        React.createElement('div', { className: 'bottom-nav' },
          React.createElement('div', { className: 'nav-container' },
            React.createElement('button', {
              onClick: () => setActiveTab('chats'),
              className: `nav-btn ${activeTab === 'chats' ? 'active' : ''}`
            },
              React.createElement(MessageCircleIcon, {
                className: `nav-icon ${activeTab === 'chats' ? 'active' : 'inactive'}`
              }),
              React.createElement('span', {
                className: `nav-label ${activeTab === 'chats' ? 'active' : 'inactive'}`
              }, 'Chats')
            ),
            React.createElement('button', {
              onClick: () => setActiveTab('settings'),
              className: `nav-btn ${activeTab === 'settings' ? 'active' : ''}`
            },
              React.createElement(SettingsIcon, {
                className: `nav-icon ${activeTab === 'settings' ? 'active' : 'inactive'}`
              }),
              React.createElement('span', {
                className: `nav-label ${activeTab === 'settings' ? 'active' : 'inactive'}`
              }, 'Settings')
            )
          )
        )
      );
    }

    // Безопасный рендер приложения
    try {
      ReactDOM.render(React.createElement(ModernMessenger), document.getElementById('root'));
    } catch (error) {
      console.error('React rendering error:', error);
      document.getElementById('root').innerHTML = `
        <div style="display: flex; justify-content: center; align-items: center; height: 100vh; background: #000; color: #fff;">
          <div style="text-align: center;">
            <h1 style="color: #ef4444; margin-bottom: 20px;">Application Error</h1>
            <p>Please refresh the page or check the console for details.</p>
            <button onclick="window.location.reload()" style="margin-top: 20px; padding: 10px 20px; background: #fff; color: #000; border: none; border-radius: 20px; cursor: pointer;">
              Refresh Page
            </button>
          </div>
        </div>
      `;
    }
  </script>
</body>
</html>
